const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-VDZ4JZpb.js","assets/vendor-cs3zdoKa.js","assets/vendor-BEpIeRJm.css","assets/calendar-D2ofcCv5.js","assets/calendar-Cb74IefQ.css","assets/index-nhF-x-lx.js","assets/index-CRkKb5Y7.css","assets/index-CH0Oj2gZ.css"])))=>i.map(i=>d[i]);
import{u as ee,a as te,b as se,c as ne,d as ae,e as re,P as q,B as j,R as ie,T as J,F as N,L as A,f as b,g as k,S as le,h as oe,i as M,j as ce,_ as de}from"./index-nhF-x-lx.js";import{R as F,F as e,au as pe,a9 as ue,Q as me,P as S,G as h,W as E,a3 as xe}from"./vendor-cs3zdoKa.js";function G({options:g,selectedValues:v,onToggle:d,className:D,style:w}){const u=v instanceof Set?v:new Set(v),m=F.useCallback((o,p)=>{p?.preventDefault?.(),p?.stopPropagation?.();const i=!u.has(o);d(o,i)},[d,u]);return!g||g.length===0?e.jsx("div",{style:{color:"#666",fontStyle:"italic"},children:"No options"}):e.jsx("div",{className:D,style:{display:"flex",flexDirection:"column",gap:8,...w||{}},children:g.map(o=>{const p=u.has(o.value);return e.jsxs("div",{onClick:i=>m(o.value,i),style:{display:"flex",alignItems:"center",padding:8,border:`1px solid ${p?"#4CAF50":"#ddd"}`,borderRadius:4,background:p?"#e8f5e9":"transparent",cursor:"pointer",userSelect:"none"},role:"checkbox","aria-checked":p,tabIndex:0,onKeyDown:i=>{(i.key===" "||i.key==="Enter")&&(i.preventDefault(),m(o.value,i))},children:[e.jsx(pe,{checked:p,onChange:i=>m(o.value,i),onClick:i=>i.stopPropagation(),style:{marginRight:8,cursor:"pointer"}}),e.jsx("span",{style:{flex:1},children:o?.title}),p&&e.jsx("span",{style:{color:"#4CAF50",fontSize:"0.9em"},children:"âœ“"})]},o.value)})})}const he=F.lazy(()=>de(()=>import("./index-VDZ4JZpb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(g=>({default:g.CalendarComponent})));function ye(){const{eventAddress:g}=ue(),v=me(),{showToast:d}=ee(),{userAddress:D}=te(),{wallet:w}=se(),u=D||(w?S.Address.parse(w):null),m=g?S.Address.parse(g):null,{participants:o}=ne(m),{addExpense:p}=ae(),[i,R]=h.useState(""),[f,L]=h.useState(""),[B,W]=h.useState(""),[a,P]=h.useState("equality"),[c,_]=h.useState(new Set),[y,Y]=h.useState(new Set),[I,V]=h.useState(""),[O,U]=h.useState(""),[T,$]=h.useState(new Map),K=F.useCallback((t,s)=>{$(n=>{const l=new Map(n);return s.trim()?l.set(t,s):l.delete(t),l})},[]),Q=F.useCallback(async()=>{if(E.impactOccurred("soft"),!m||!i||!f){d({type:"warning",message:"Please fill in all fields"});return}if(c.size===0){d({type:"warning",message:"Please select at least one participant"});return}if(y.size===0){d({type:"warning",message:"Please select at least one person who paid"});return}if(E.impactOccurred("light"),a==="sum"){const t=parseFloat(f);let s=0;if(c.forEach(n=>{const l=T.get(n);if(!l||parseFloat(l)<=0){d({type:"warning",message:`Please enter amount for all participants (${n.toString().slice(0,8)}...)`});return}s+=parseFloat(l)}),Math.abs(s-t)>.01){d({type:"error",message:`Sum of participant amounts (${s.toFixed(2)} TON) must equal total amount (${t.toFixed(2)} TON)`});return}}try{const t=S.Dictionary.empty();c.forEach(x=>{t.set(x,!0)});const s=S.Dictionary.empty();y.forEach(x=>{s.set(x,!0)});let n=O.trim()||"";const l={splitType:a};if(a==="sum"||a==="proportion"){const x={};c.forEach(z=>{const C=T.get(z);C&&(x[z.toString()]=C)}),l.amounts=x}const r=JSON.stringify(l);n?n=`${n}
[SPLIT:${r}]`:n=`[SPLIT:${r}]`,await p(m,{title:i,amount:S.toNano(f),date:BigInt(Math.floor(new Date(B||Date.now()).getTime()/1e3)),participants:t,paidBy:s,imageBagId:I.trim()||null,comment:n||null}),R(""),L(""),W(""),V(""),U(""),_(new Set),Y(new Set),P("equality"),$(new Map),d({type:"success",message:"Expense added successfully!"}),v(`/events/${m.toString()}`)}catch(t){console.error("Failed to add expense:",t),d({type:"error",message:"Failed to add expense. Please try again."})}},[p,m,f,O,B,I,a,i,T,y,c,v,d]),{needsCreation:H}=re();return H?e.jsx(q,{back:!1,children:e.jsxs(j,{children:[e.jsx(xe,{}),e.jsx(ie,{})]})}):m?e.jsx(q,{back:!0,children:e.jsxs(N,{children:[e.jsx(J,{type:"title1",children:"Add Expense"}),e.jsx(j,{children:e.jsxs(N,{children:[e.jsx(j,{margin:"top",marginValue:12,children:e.jsx(A,{header:"Expense title",children:e.jsx(b,{after:null,disabled:!1,children:e.jsx(k,{placeholder:"Enter Title",value:i,onChange:R})})})}),e.jsx(j,{margin:"top",marginValue:12,children:e.jsx(A,{header:"Amount (TON) *",children:e.jsx(b,{after:null,disabled:!1,children:e.jsx(k,{type:"number",pattern:"[0-9]*",inputMode:"decimal",placeholder:"Enter Amount",value:f,onChange:t=>L(t.replace(",","."))})})})}),e.jsx(j,{margin:"top",marginValue:12,children:e.jsx(A,{header:"Date *",children:e.jsx(b,{children:e.jsx(h.Suspense,{fallback:e.jsx(le,{size:16}),children:e.jsx(he,{placeholder:"YYYY-MM-DD",value:B,onChange:W})})})})}),e.jsxs("div",{style:{marginTop:16},children:[e.jsxs("label",{style:{display:"block",marginBottom:8},children:[e.jsx("strong",{children:"Select Participants *"}),e.jsx("span",{style:{fontSize:"0.85em",color:"#666",marginLeft:8,fontWeight:"normal"},children:"(Select multiple)"})]}),o&&o.size>0?e.jsx(G,{options:Array.from(o.keys()).map(t=>{const s=t.toString(),n=`${s.slice(0,8)}...${u&&t.equals(u)?" (You)":""}`;return{value:s,title:n}}),selectedValues:Array.from(c).map(t=>t.toString()),onToggle:(t,s)=>{const n=S.Address.parse(t);_(l=>{const r=new Set(l);return s?r.add(n):r.delete(n),r}),s||$(l=>{const r=new Map(l);return r.delete(n),r})}}):e.jsx("div",{style:{color:"#666",fontStyle:"italic"},children:"No participants yet. Add participants to the event first."}),c.size>0&&e.jsxs("div",{style:{marginTop:8,fontSize:"0.85em",color:"#4CAF50"},children:[c.size," participant",c.size!==1?"s":""," selected"]})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsxs("label",{style:{display:"block",marginBottom:8},children:[e.jsx("strong",{children:"Select Who Paid *"}),e.jsx("span",{style:{fontSize:"0.85em",color:"#666",marginLeft:8,fontWeight:"normal"},children:"(Select multiple)"})]}),o&&o.size>0?e.jsx(G,{options:Array.from(o.keys()).map(t=>{const s=t.toString(),n=`${s.slice(0,8)}...${u&&t.equals(u)?" (You)":""}`;return{value:s,title:n}}),selectedValues:Array.from(y).map(t=>t.toString()),onToggle:(t,s)=>{const n=S.Address.parse(t);Y(l=>{const r=new Set(l);return s?r.add(n):r.delete(n),r})}}):e.jsx("div",{style:{color:"#666",fontStyle:"italic"},children:"No participants yet."}),y.size>0&&e.jsxs("div",{style:{marginTop:8,fontSize:"0.85em",color:"#2196F3"},children:[y.size," payer",y.size!==1?"s":""," selected"]})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx("label",{style:{display:"block",marginBottom:8},children:e.jsx("strong",{children:"Split Type"})}),e.jsxs(oe,{style:{gap:8},children:[e.jsx(M,{onClick:()=>{E.impactOccurred("medium"),P("equality")},style:{flex:1,backgroundColor:a==="equality"?"#4CAF50":"#ddd",color:a==="equality"?"white":"black"},children:"Equal"}),e.jsx(M,{onClick:()=>{E.impactOccurred("medium"),P("proportion")},style:{flex:1,backgroundColor:a==="proportion"?"#4CAF50":"#ddd",color:a==="proportion"?"white":"black"},children:"Proportion"}),e.jsx(M,{onClick:()=>{E.impactOccurred("medium"),P("sum")},style:{flex:1,backgroundColor:a==="sum"?"#4CAF50":"#ddd",color:a==="sum"?"white":"black"},children:"Sum"})]}),e.jsxs("div",{style:{marginTop:4,fontSize:"0.85em",color:"#666"},children:[a==="equality"&&"Divide equally between all participants",a==="proportion"&&"Divide proportionally (specify proportions)",a==="sum"&&"Enter the amount and select participants for calculation"]})]}),(a==="sum"||a==="proportion")&&c.size>0&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx("label",{style:{display:"block",marginBottom:8},children:e.jsx("strong",{children:a==="sum"?"Enter the amount for each participant":"Enter the proportion for each participant"})}),e.jsx(N,{style:{gap:8},children:Array.from(c).map(t=>{const s=T.get(t)||"",n=u&&t.equals(u),l=parseFloat(f)||0;let r=0;if(a==="sum"){const x=parseFloat(s)||0,z=Array.from(c).filter(C=>!C.equals(t)).reduce((C,X)=>{const Z=T.get(X);return C+(parseFloat(Z||"0")||0)},0);r=l-z-x}return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:120},children:e.jsxs("span",{children:[t.toString().slice(0,8),"...",n&&" (You)"]})}),e.jsx("div",{style:{flex:1,maxWidth:180},children:e.jsx(j,{children:e.jsx(A,{header:a==="sum"?"TON":"Weight",children:e.jsx(b,{after:null,disabled:!1,children:e.jsx(k,{placeholder:a==="sum"?"0.00 TON":"0.00",value:s,onChange:x=>K(t,x.replace(",","."))})})})})}),a==="sum"&&e.jsx("span",{style:{fontSize:"0.85em",color:r>=0?"#666":"#f44336",minWidth:120},children:r>=0?`Need: ${r.toFixed(2)}`:`Exceeding: ${Math.abs(r).toFixed(2)}`})]},t.toString())})}),a==="sum"&&e.jsxs("div",{style:{marginTop:8,fontSize:"0.85em",color:"#666"},children:["Total amount: ",f||"0"," TON"]})]}),e.jsx(j,{margin:"top",marginValue:24,children:e.jsx(A,{header:"Image URL",children:e.jsx(b,{after:null,disabled:!1,children:e.jsx(k,{placeholder:"Image URL (optional)",value:I,onChange:V})})})}),e.jsx(j,{margin:"top",marginValue:24,children:e.jsx(A,{header:"Comment",children:e.jsx(b,{after:null,disabled:!1,children:e.jsx(k,{placeholder:"Optional comment",value:O,onChange:U})})})}),e.jsx(ce,{disabled:!i||!f||c.size===0||y.size===0,text:"Add Expense",onClick:Q})]})})]})}):e.jsx(q,{back:!0,children:e.jsx(J,{type:"text",children:"Invalid event address"})})}export{ye as AddExpensePage};
