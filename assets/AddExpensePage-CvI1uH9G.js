const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DkYWbSJ6.js","assets/vendor-BjaQ3eXk.js","assets/vendor-BEpIeRJm.css","assets/calendar-1UqkhD1H.js","assets/calendar-Cb74IefQ.css","assets/index-BaOKLuth.js","assets/index-DETNpTE9.css","assets/index-CH0Oj2gZ.css"])))=>i.map(i=>d[i]);
import{B as o,L as C,a as p,u as se,b as re,c as ie,d as ae,e as oe,f as le,P as G,R as ce,T as N,F as X,g as M,S as de,h as F,i as pe,j as H,k as ue,_ as me}from"./index-BaOKLuth.js";import{G as d,R as Y,F as e,O as S,P as he,a9 as xe,X as ge,W as v,a2 as fe}from"./vendor-BjaQ3eXk.js";const ye="_container_7dyeo_1",je="_input_7dyeo_6",Se="_disabled_7dyeo_25",we="_selectedText_7dyeo_30",Te="_placeholderText_7dyeo_36",ve="_arrow_7dyeo_43",Ce="_overlay_7dyeo_50",_e="_dropdown_7dyeo_60",ke="_optionContent_7dyeo_71",Ae="_optionTitle_7dyeo_78",Ee="_checkmark_7dyeo_84",g={container:ye,input:je,disabled:Se,selectedText:we,placeholderText:Te,arrow:ve,overlay:Ce,dropdown:_e,optionContent:ke,optionTitle:Ae,checkmark:Ee};function K({options:k,selectedValues:f,onToggle:m,placeholder:U="Select options",className:$,style:w,disabled:h=!1,inline:_=!1}){const[A,I]=d.useState(!1),[T,L]=d.useState({top:0,left:0,width:0}),u=d.useRef(null),[D,P]=d.useState(()=>f instanceof Set?new Set(f):new Set(f));d.useEffect(()=>{const n=f instanceof Set?new Set(f):new Set(f);P(n)},[f]);const O=D.size,r=O>0?`${O} selected`:U;d.useEffect(()=>{if(A&&u.current){const n=u.current.getBoundingClientRect();L({top:n.bottom+4,left:n.left,width:n.width})}},[A]);const E=Y.useCallback(n=>{h||P(b=>{const y=new Set(b),R=!y.has(n);return R?y.add(n):y.delete(n),m(n,R),y})},[m,h]),c=()=>{h||(S.impactOccurred("soft"),I(n=>!n))},B=()=>e.jsx(o,{children:e.jsx(C,{children:k.length===0?e.jsx(p,{children:e.jsx("span",{style:{color:"var(--color-textIconsTertiary)",fontStyle:"italic"},children:"No options available"})}):k.map(n=>{const b=D.has(n.value);return e.jsx(p,{onClick:()=>{S.impactOccurred("soft"),E(n.value)},children:e.jsxs("div",{className:g.optionContent,style:{cursor:"pointer"},onClick:y=>{y.stopPropagation(),y.preventDefault(),S.impactOccurred("soft"),E(n.value)},children:[e.jsx("span",{className:g.optionTitle,children:n.title}),b&&e.jsx("span",{className:g.checkmark,children:"✓"})]})},n.value)})})});if(_)return e.jsx("div",{className:$,style:w,children:B()});const x=A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:g.overlay,onClick:n=>{S.impactOccurred("soft"),n.stopPropagation(),I(!1)}}),e.jsx("div",{className:g.dropdown,style:{position:"fixed",top:T.top,left:T.left,width:T.width||"auto",minWidth:200},onClick:n=>n.stopPropagation(),children:B()})]}):null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:u,className:`${g.container} ${$||""}`,style:w,onClick:c,children:e.jsxs("div",{className:`${g.input} ${h?g.disabled:""}`,children:[e.jsx("span",{className:O>0?g.selectedText:g.placeholderText,children:r}),e.jsx("span",{className:g.arrow,children:A?"▲":"▼"})]})}),typeof document<"u"&&he.createPortal(x,document.body)]})}const be=Y.lazy(()=>me(()=>import("./index-DkYWbSJ6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(k=>({default:k.CalendarComponent})));function ze(){const{eventAddress:k}=xe(),f=ge(),{showToast:m}=se(),{userAddress:U}=re(),{wallet:$}=ie(),w=U||($?v.Address.parse($):null),h=k?v.Address.parse(k):null,{participants:_,loading:A}=ae(h),{addExpense:I}=oe(),[T,L]=d.useState(""),[u,D]=d.useState(""),[P,O]=d.useState(""),[r,E]=d.useState("equality"),[c,B]=d.useState(new Set),[x,n]=d.useState(new Set),[b,y]=d.useState(""),[V,R]=d.useState(""),[q,J]=d.useState(new Map);console.log({selectedPaidBy:x,selectedParticipants:c});const Q=Y.useCallback((t,s)=>{J(i=>{const l=new Map(i);return s.trim()?l.set(t,s):l.delete(t),l})},[]),Z=Y.useCallback(async()=>{if(S.impactOccurred("soft"),!h||!T||!u){m({type:"warning",message:"Please fill in all fields"});return}if(c.size===0){m({type:"warning",message:"Please select at least one participant"});return}if(x.size===0){m({type:"warning",message:"Please select at least one person who paid"});return}if(S.impactOccurred("light"),r==="sum"){const t=parseFloat(u);let s=0;if(c.forEach(i=>{const l=q.get(i);if(!l||parseFloat(l)<=0){m({type:"warning",message:`Please enter amount for all participants (${i.toString().slice(0,8)}...)`});return}s+=parseFloat(l)}),Math.abs(s-t)>.01){m({type:"error",message:`Sum of participant amounts (${s.toFixed(2)} TON) must equal total amount (${t.toFixed(2)} TON)`});return}}try{const t=v.Dictionary.empty();c.forEach(j=>{t.set(v.Address.parse(j),!0)});const s=v.Dictionary.empty();x.forEach(j=>{s.set(v.Address.parse(j),!0)});let i=V.trim()||"";const l={splitType:r};if(r==="sum"||r==="proportion"){const j={};c.forEach(W=>{const z=q.get(W);z&&(j[W.toString()]=z)}),l.amounts=j}const a=JSON.stringify(l);i?i=`${i}
[SPLIT:${a}]`:i=`[SPLIT:${a}]`,await I(h,{title:T,amount:v.toNano(u),date:BigInt(Math.floor(new Date(P||Date.now()).getTime()/1e3)),participants:t,paidBy:s,imageBagId:b.trim()||null,comment:i||null}),L(""),D(""),O(""),y(""),R(""),B(new Set),n(new Set),E("equality"),J(new Map),m({type:"success",message:"Expense added successfully!"}),f(`/events/${h.toString()}`)}catch(t){console.error("Failed to add expense:",t),m({type:"error",message:"Failed to add expense. Please try again."})}},[I,h,u,V,P,b,r,T,q,x,c,f,m]),{needsCreation:ee}=le();return ee?e.jsx(G,{back:!1,children:e.jsxs(o,{children:[e.jsx(fe,{}),e.jsx(ce,{})]})}):h?e.jsx(G,{back:!0,children:e.jsxs(X,{children:[e.jsx(N,{type:"title1",children:"Add Expense"}),e.jsx(o,{children:e.jsxs(X,{children:[e.jsx(o,{margin:"top",marginValue:12,children:e.jsx(C,{header:"Expense title",children:e.jsx(p,{after:null,disabled:!1,children:e.jsx(M,{placeholder:"Enter Title",value:T,onChange:L})})})}),e.jsx(o,{margin:"top",marginValue:12,children:e.jsx(C,{header:"Amount (TON) *",children:e.jsx(p,{after:null,disabled:!1,children:e.jsx(M,{type:"number",pattern:"[0-9]*",inputMode:"decimal",placeholder:"Enter Amount",value:u,onChange:t=>D(t.replace(",","."))})})})}),e.jsx(o,{margin:"top",marginValue:12,children:e.jsx(C,{header:"Date *",children:e.jsx(p,{children:e.jsx(d.Suspense,{fallback:e.jsx(de,{size:16}),children:e.jsx(be,{placeholder:"YYYY-MM-DD",value:P,onChange:O})})})})}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx(o,{margin:"bottom",marginValue:6,children:e.jsx(o,{margin:"left",marginValue:16,children:e.jsx(N,{type:"caption",color:"tertiary",uppercase:!0,children:"Select Participants *"})})}),_&&_.size>0?e.jsx(K,{inline:!0,placeholder:"Select participants",options:Array.from(_.keys()).map(t=>{const s=t.toString(),i=`${s.slice(0,8)}...${w&&t.equals(w)?" (You)":""}`;return{value:s,title:i}}),selectedValues:Array.from(c).map(t=>t.toString()),onToggle:(t,s)=>{const i=v.Address.parse(t);console.log({addr:i,checked:s}),S.impactOccurred("soft"),B(l=>{const a=new Set(l);return s?a.add(t):a.delete(t),a}),s||J(l=>{const a=new Map(l);return a.delete(t),a})}}):A?e.jsx(o,{children:e.jsxs(C,{children:[e.jsx(p,{children:e.jsx(F,{style:{height:20,width:"100%"}})}),e.jsx(p,{children:e.jsx(F,{style:{height:20,width:"80%"}})}),e.jsx(p,{children:e.jsx(F,{style:{height:20,width:"90%"}})})]})}):e.jsx("div",{style:{color:"#666",fontStyle:"italic"},children:"No participants yet. Add participants to the event first."}),c.size>0&&e.jsxs("div",{style:{marginTop:8,fontSize:"0.85em",color:"#4CAF50"},children:[c.size," participant",c.size!==1?"s":""," selected"]})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx(o,{margin:"bottom",marginValue:6,children:e.jsx(o,{margin:"left",marginValue:16,children:e.jsx(N,{type:"caption",color:"tertiary",uppercase:!0,children:"Select Who Paid *"})})}),_&&_.size>0?e.jsx(K,{inline:!0,placeholder:"Select who paid",options:Array.from(_.keys()).map(t=>{const s=t.toString(),i=`${s.slice(0,8)}...${w&&t.equals(w)?" (You)":""}`;return{value:s,title:i}}),selectedValues:Array.from(x).map(t=>t.toString()),onToggle:(t,s)=>{const i=v.Address.parse(t);console.log({addr:i,checked:s}),n(l=>{const a=new Set(l);return s?a.add(t):a.delete(t),a})}}):A?e.jsx(o,{children:e.jsxs(C,{children:[e.jsx(p,{children:e.jsx(F,{style:{height:20,width:"100%"}})}),e.jsx(p,{children:e.jsx(F,{style:{height:20,width:"80%"}})}),e.jsx(p,{children:e.jsx(F,{style:{height:20,width:"90%"}})})]})}):e.jsx("div",{style:{color:"#666",fontStyle:"italic"},children:"No participants yet."}),x.size>0&&e.jsxs("div",{style:{marginTop:8,fontSize:"0.85em",color:"#2196F3"},children:[x.size," payer",x.size!==1?"s":""," selected"]})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx(o,{margin:"bottom",marginValue:6,children:e.jsx(o,{margin:"left",marginValue:16,children:e.jsx(N,{type:"caption",color:"tertiary",uppercase:!0,children:"Split Type"})})}),e.jsxs(pe,{style:{gap:8},children:[e.jsx(H,{onClick:()=>{S.impactOccurred("medium"),E("equality")},style:{flex:1,backgroundColor:r==="equality"?"#2688eb":"#ddd",color:r==="equality"?"white":"black"},children:"Equal"}),e.jsx(H,{onClick:()=>{S.impactOccurred("medium"),E("proportion")},style:{flex:1,backgroundColor:r==="proportion"?"#2688eb":"#ddd",color:r==="proportion"?"white":"black"},children:"Proportion"}),e.jsx(H,{onClick:()=>{S.impactOccurred("medium"),E("sum")},style:{flex:1,backgroundColor:r==="sum"?"#2688eb":"#ddd",color:r==="sum"?"white":"black"},children:"Sum"})]}),e.jsxs("div",{style:{marginTop:4,fontSize:"0.85em",color:"#666"},children:[r==="equality"&&"Divide equally between all participants",r==="proportion"&&"Divide proportionally (specify proportions)",r==="sum"&&"Enter the amount and select participants for calculation"]})]}),(r==="sum"||r==="proportion")&&c.size>0&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx(o,{margin:"bottom",marginValue:6,children:e.jsx(o,{margin:"left",marginValue:16,children:e.jsx(N,{type:"caption",color:"tertiary",uppercase:!0,children:r==="sum"?"Enter the amount for each participant":"Enter the proportion for each participant"})})}),e.jsx(X,{style:{gap:8},children:Array.from(c).map(t=>{const s=q.get(t)||"",i=w&&t===w.toString(),l=parseFloat(u)||0;let a=0;if(r==="sum"){const j=parseFloat(s)||0,W=Array.from(c).filter(z=>z!==t.toString()).reduce((z,te)=>{const ne=q.get(te);return z+(parseFloat(ne||"0")||0)},0);a=l-W-j}return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:120},children:e.jsxs("span",{children:[t.toString().slice(0,8),"...",i&&" (You)"]})}),e.jsx("div",{style:{flex:1,maxWidth:180},children:e.jsx(o,{children:e.jsx(C,{header:r==="sum"?"TON":"Weight",children:e.jsx(p,{after:null,disabled:!1,children:e.jsx(M,{placeholder:r==="sum"?"0.00 TON":"0.00",value:s,onChange:j=>Q(t.toString(),j.replace(",","."))})})})})}),r==="sum"&&e.jsx("span",{style:{fontSize:"0.85em",color:a>=0?"#666":"#f44336",minWidth:120},children:a>=0?`Need: ${a.toFixed(2)}`:`Exceeding: ${Math.abs(a).toFixed(2)}`})]},t.toString())})}),r==="sum"&&e.jsxs("div",{style:{marginTop:8,fontSize:"0.85em",color:"#666"},children:["Total amount: ",u||"0"," TON"]})]}),e.jsx(o,{margin:"top",marginValue:24,children:e.jsx(C,{header:"Image URL",children:e.jsx(p,{after:null,disabled:!1,children:e.jsx(M,{placeholder:"Image URL (optional)",value:b,onChange:y})})})}),e.jsx(o,{margin:"top",marginValue:24,children:e.jsx(C,{header:"Comment",children:e.jsx(p,{after:null,disabled:!1,children:e.jsx(M,{placeholder:"Optional comment",value:V,onChange:R})})})}),e.jsx(ue,{disabled:!T||!u||c.size===0||x.size===0,text:"Add Expense",onClick:Z})]})})]})}):e.jsx(G,{back:!0,children:e.jsx(N,{type:"text",children:"Invalid event address"})})}export{ze as AddExpensePage};
