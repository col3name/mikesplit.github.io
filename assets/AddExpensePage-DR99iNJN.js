const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BifF3Mur.js","assets/vendor-C4dca1F1.js","assets/vendor-BEpIeRJm.css","assets/calendar-CvL2JTjs.js","assets/calendar-Cb74IefQ.css","assets/index-ELlclUMW.js","assets/index-CRkKb5Y7.css","assets/index-CH0Oj2gZ.css"])))=>i.map(i=>d[i]);
import{B as c,L as k,a as _,u as te,b as ne,c as se,d as re,e as ae,f as oe,P as U,R as ie,T as $,F as J,g as B,S as le,h as ce,i as G,j as de,_ as pe}from"./index-ELlclUMW.js";import{G as d,R as L,F as e,W as j,X as ue,a9 as me,Q as xe,P as C,a3 as he}from"./vendor-C4dca1F1.js";const fe="_container_7dyeo_1",ge="_input_7dyeo_6",ye="_disabled_7dyeo_25",je="_selectedText_7dyeo_30",Se="_placeholderText_7dyeo_36",Ce="_arrow_7dyeo_43",Te="_overlay_7dyeo_50",ve="_dropdown_7dyeo_60",we="_optionContent_7dyeo_71",_e="_optionTitle_7dyeo_78",Ae="_checkmark_7dyeo_84",h={container:fe,input:ge,disabled:ye,selectedText:je,placeholderText:Se,arrow:Ce,overlay:Te,dropdown:ve,optionContent:we,optionTitle:_e,checkmark:Ae};function Q({options:A,selectedValues:f,onToggle:u,placeholder:V="Select options",className:I,style:S,disabled:m=!1,inline:T=!1}){const[E,v]=d.useState(!1),[b,g]=d.useState({top:0,left:0,width:0}),P=d.useRef(null),[F,D]=d.useState(()=>f instanceof Set?new Set(f):new Set(f));d.useEffect(()=>{const s=f instanceof Set?new Set(f):new Set(f);D(s)},[f]);const n=F.size,O=n>0?`${n} selected`:V;d.useEffect(()=>{if(E&&P.current){const s=P.current.getBoundingClientRect();g({top:s.bottom+4,left:s.left,width:s.width})}},[E]);const l=L.useCallback(s=>{m||D(z=>{const x=new Set(z),w=!x.has(s);return w?x.add(s):x.delete(s),u(s,w),x})},[u,m]),R=()=>{m||(j.impactOccurred("soft"),v(s=>!s))},p=()=>e.jsx(c,{children:e.jsx(k,{children:A.length===0?e.jsx(_,{children:e.jsx("span",{style:{color:"var(--color-textIconsTertiary)",fontStyle:"italic"},children:"No options available"})}):A.map(s=>{const z=F.has(s.value);return e.jsx(_,{onClick:()=>{j.impactOccurred("soft"),l(s.value)},children:e.jsxs("div",{className:h.optionContent,style:{cursor:"pointer"},onClick:x=>{x.stopPropagation(),x.preventDefault(),j.impactOccurred("soft"),l(s.value)},children:[e.jsx("span",{className:h.optionTitle,children:s.title}),z&&e.jsx("span",{className:h.checkmark,children:"✓"})]})},s.value)})})});if(T)return e.jsx("div",{className:I,style:S,children:p()});const q=E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:h.overlay,onClick:s=>{j.impactOccurred("soft"),s.stopPropagation(),v(!1)}}),e.jsx("div",{className:h.dropdown,style:{position:"fixed",top:b.top,left:b.left,width:b.width||"auto",minWidth:200},onClick:s=>s.stopPropagation(),children:p()})]}):null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:P,className:`${h.container} ${I||""}`,style:S,onClick:R,children:e.jsxs("div",{className:`${h.input} ${m?h.disabled:""}`,children:[e.jsx("span",{className:n>0?h.selectedText:h.placeholderText,children:O}),e.jsx("span",{className:h.arrow,children:E?"▲":"▼"})]})}),typeof document<"u"&&ue.createPortal(q,document.body)]})}const Ee=L.lazy(()=>pe(()=>import("./index-BifF3Mur.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(A=>({default:A.CalendarComponent})));function Pe(){const{eventAddress:A}=me(),f=xe(),{showToast:u}=te(),{userAddress:V}=ne(),{wallet:I}=se(),S=V||(I?C.Address.parse(I):null),m=A?C.Address.parse(A):null,{participants:T}=re(m),{addExpense:E}=ae(),[v,b]=d.useState(""),[g,P]=d.useState(""),[F,D]=d.useState(""),[n,O]=d.useState("equality"),[l,R]=d.useState(new Set),[p,q]=d.useState(new Set),[s,z]=d.useState(""),[x,W]=d.useState(""),[w,Y]=d.useState(new Map);console.log({selectedPaidBy:p,selectedParticipants:l});const X=L.useCallback((t,r)=>{Y(a=>{const i=new Map(a);return r.trim()?i.set(t,r):i.delete(t),i})},[]),H=L.useCallback(async()=>{if(j.impactOccurred("soft"),!m||!v||!g){u({type:"warning",message:"Please fill in all fields"});return}if(l.size===0){u({type:"warning",message:"Please select at least one participant"});return}if(p.size===0){u({type:"warning",message:"Please select at least one person who paid"});return}if(j.impactOccurred("light"),n==="sum"){const t=parseFloat(g);let r=0;if(l.forEach(a=>{const i=w.get(a);if(!i||parseFloat(i)<=0){u({type:"warning",message:`Please enter amount for all participants (${a.toString().slice(0,8)}...)`});return}r+=parseFloat(i)}),Math.abs(r-t)>.01){u({type:"error",message:`Sum of participant amounts (${r.toFixed(2)} TON) must equal total amount (${t.toFixed(2)} TON)`});return}}try{const t=C.Dictionary.empty();l.forEach(y=>{t.set(C.Address.parse(y),!0)});const r=C.Dictionary.empty();p.forEach(y=>{r.set(C.Address.parse(y),!0)});let a=x.trim()||"";const i={splitType:n};if(n==="sum"||n==="proportion"){const y={};l.forEach(M=>{const N=w.get(M);N&&(y[M.toString()]=N)}),i.amounts=y}const o=JSON.stringify(i);a?a=`${a}
[SPLIT:${o}]`:a=`[SPLIT:${o}]`,await E(m,{title:v,amount:C.toNano(g),date:BigInt(Math.floor(new Date(F||Date.now()).getTime()/1e3)),participants:t,paidBy:r,imageBagId:s.trim()||null,comment:a||null}),b(""),P(""),D(""),z(""),W(""),R(new Set),q(new Set),O("equality"),Y(new Map),u({type:"success",message:"Expense added successfully!"}),f(`/events/${m.toString()}`)}catch(t){console.error("Failed to add expense:",t),u({type:"error",message:"Failed to add expense. Please try again."})}},[E,m,g,x,F,s,n,v,w,p,l,f,u]),{needsCreation:K}=oe();return K?e.jsx(U,{back:!1,children:e.jsxs(c,{children:[e.jsx(he,{}),e.jsx(ie,{})]})}):m?e.jsx(U,{back:!0,children:e.jsxs(J,{children:[e.jsx($,{type:"title1",children:"Add Expense"}),e.jsx(c,{children:e.jsxs(J,{children:[e.jsx(c,{margin:"top",marginValue:12,children:e.jsx(k,{header:"Expense title",children:e.jsx(_,{after:null,disabled:!1,children:e.jsx(B,{placeholder:"Enter Title",value:v,onChange:b})})})}),e.jsx(c,{margin:"top",marginValue:12,children:e.jsx(k,{header:"Amount (TON) *",children:e.jsx(_,{after:null,disabled:!1,children:e.jsx(B,{type:"number",pattern:"[0-9]*",inputMode:"decimal",placeholder:"Enter Amount",value:g,onChange:t=>P(t.replace(",","."))})})})}),e.jsx(c,{margin:"top",marginValue:12,children:e.jsx(k,{header:"Date *",children:e.jsx(_,{children:e.jsx(d.Suspense,{fallback:e.jsx(le,{size:16}),children:e.jsx(Ee,{placeholder:"YYYY-MM-DD",value:F,onChange:D})})})})}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx(c,{margin:"bottom",marginValue:6,children:e.jsx(c,{margin:"left",marginValue:16,children:e.jsx($,{type:"caption",color:"tertiary",uppercase:!0,children:"Select Participants *"})})}),T&&T.size>0?e.jsx(Q,{inline:!0,placeholder:"Select participants",options:Array.from(T.keys()).map(t=>{const r=t.toString(),a=`${r.slice(0,8)}...${S&&t.equals(S)?" (You)":""}`;return{value:r,title:a}}),selectedValues:Array.from(l).map(t=>t.toString()),onToggle:(t,r)=>{const a=C.Address.parse(t);console.log({addr:a,checked:r}),j.impactOccurred("soft"),R(i=>{const o=new Set(i);return r?o.add(t):o.delete(t),o}),r||Y(i=>{const o=new Map(i);return o.delete(t),o})}}):e.jsx("div",{style:{color:"#666",fontStyle:"italic"},children:"No participants yet. Add participants to the event first."}),l.size>0&&e.jsxs("div",{style:{marginTop:8,fontSize:"0.85em",color:"#4CAF50"},children:[l.size," participant",l.size!==1?"s":""," selected"]})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx(c,{margin:"bottom",marginValue:6,children:e.jsx(c,{margin:"left",marginValue:16,children:e.jsx($,{type:"caption",color:"tertiary",uppercase:!0,children:"Select Who Paid *"})})}),T&&T.size>0?e.jsx(Q,{inline:!0,placeholder:"Select who paid",options:Array.from(T.keys()).map(t=>{const r=t.toString(),a=`${r.slice(0,8)}...${S&&t.equals(S)?" (You)":""}`;return{value:r,title:a}}),selectedValues:Array.from(p).map(t=>t.toString()),onToggle:(t,r)=>{const a=C.Address.parse(t);console.log({addr:a,checked:r}),q(i=>{const o=new Set(i);return r?o.add(t):o.delete(t),o})}}):e.jsx("div",{style:{color:"#666",fontStyle:"italic"},children:"No participants yet."}),p.size>0&&e.jsxs("div",{style:{marginTop:8,fontSize:"0.85em",color:"#2196F3"},children:[p.size," payer",p.size!==1?"s":""," selected"]})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx(c,{margin:"bottom",marginValue:6,children:e.jsx(c,{margin:"left",marginValue:16,children:e.jsx($,{type:"caption",color:"tertiary",uppercase:!0,children:"Split Type"})})}),e.jsxs(ce,{style:{gap:8},children:[e.jsx(G,{onClick:()=>{j.impactOccurred("medium"),O("equality")},style:{flex:1,backgroundColor:n==="equality"?"#4CAF50":"#ddd",color:n==="equality"?"white":"black"},children:"Equal"}),e.jsx(G,{onClick:()=>{j.impactOccurred("medium"),O("proportion")},style:{flex:1,backgroundColor:n==="proportion"?"#4CAF50":"#ddd",color:n==="proportion"?"white":"black"},children:"Proportion"}),e.jsx(G,{onClick:()=>{j.impactOccurred("medium"),O("sum")},style:{flex:1,backgroundColor:n==="sum"?"#4CAF50":"#ddd",color:n==="sum"?"white":"black"},children:"Sum"})]}),e.jsxs("div",{style:{marginTop:4,fontSize:"0.85em",color:"#666"},children:[n==="equality"&&"Divide equally between all participants",n==="proportion"&&"Divide proportionally (specify proportions)",n==="sum"&&"Enter the amount and select participants for calculation"]})]}),(n==="sum"||n==="proportion")&&l.size>0&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx(c,{margin:"bottom",marginValue:6,children:e.jsx(c,{margin:"left",marginValue:16,children:e.jsx($,{type:"caption",color:"tertiary",uppercase:!0,children:n==="sum"?"Enter the amount for each participant":"Enter the proportion for each participant"})})}),e.jsx(J,{style:{gap:8},children:Array.from(l).map(t=>{const r=w.get(t)||"",a=S&&t===S.toString(),i=parseFloat(g)||0;let o=0;if(n==="sum"){const y=parseFloat(r)||0,M=Array.from(l).filter(N=>N!==t.toString()).reduce((N,Z)=>{const ee=w.get(Z);return N+(parseFloat(ee||"0")||0)},0);o=i-M-y}return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:120},children:e.jsxs("span",{children:[t.toString().slice(0,8),"...",a&&" (You)"]})}),e.jsx("div",{style:{flex:1,maxWidth:180},children:e.jsx(c,{children:e.jsx(k,{header:n==="sum"?"TON":"Weight",children:e.jsx(_,{after:null,disabled:!1,children:e.jsx(B,{placeholder:n==="sum"?"0.00 TON":"0.00",value:r,onChange:y=>X(t.toString(),y.replace(",","."))})})})})}),n==="sum"&&e.jsx("span",{style:{fontSize:"0.85em",color:o>=0?"#666":"#f44336",minWidth:120},children:o>=0?`Need: ${o.toFixed(2)}`:`Exceeding: ${Math.abs(o).toFixed(2)}`})]},t.toString())})}),n==="sum"&&e.jsxs("div",{style:{marginTop:8,fontSize:"0.85em",color:"#666"},children:["Total amount: ",g||"0"," TON"]})]}),e.jsx(c,{margin:"top",marginValue:24,children:e.jsx(k,{header:"Image URL",children:e.jsx(_,{after:null,disabled:!1,children:e.jsx(B,{placeholder:"Image URL (optional)",value:s,onChange:z})})})}),e.jsx(c,{margin:"top",marginValue:24,children:e.jsx(k,{header:"Comment",children:e.jsx(_,{after:null,disabled:!1,children:e.jsx(B,{placeholder:"Optional comment",value:x,onChange:W})})})}),e.jsx(de,{disabled:!v||!g||l.size===0||p.size===0,text:"Add Expense",onClick:H})]})})]})}):e.jsx(U,{back:!0,children:e.jsx($,{type:"text",children:"Invalid event address"})})}export{Pe as AddExpensePage};
